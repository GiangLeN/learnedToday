# Winscp script

This bat file is used to send files to the HPC using script.
Transfer files are placed into a specific folder.
Trigger the move by double click on the *bat* file.
Once the transfer is done, create a blank file saying upload done.
Send this file over to the HPC so the automation script knows all files received.

##  Generate the script
```
Press upload > Transfer settings ... > generate code
```

### *bat* file

```
:: Running the program using the typingTransfer.txt script
:: See below for how the file looks like
"C:\ProgramLocation\WinSCP\WinSCP.exe" /log="log\upload.log" /script="typingTransfer.txt"

:: If no error found
if %ERRORLEVEL% neq 0 goto error

echo Upload succeeded, moving local files

:: Back up portion
SET MoveToDir=L:\backUp_directory
SET MoveFromDir=L:\upload_directory

:: Move the folders from the move directory to the move to directory
FOR /D %%A IN ("%MoveFromDir%\*") DO MOVE /Y "%%~A" "%MoveToDir%"

:: Move the rest of the files to new location
move L:\upload_directory\*.* L:\backUp_directory

:: Creates a blank file saying the upload is completed
echo Transferred > uploaddone.txt

::: Run winscp to transfer the newly created uploaddone.txt
"C:\ProgramLocation\WinSCP\WinSCP.exe" /log="log\updone.log" /script="transferTyping_done.txt"

exit /b 0

:error
echo Upload failed, keeping local files
exit /b 1
```

> Warning: Password is very visible 

## Transfer action

The typingTransfer.txt file:

```
## Access the HPC using username and passwor
## This part is generated by winscp
open sftp://<user_name>:<password>@<ip>/ -hostkey="some random letters for hotkey"

## Change the location of the files
lcd "L:\Location\upload_folder"

## Go to directory
cd /HPC_final_directory

## Transfer of files
put *.*

exit
```

This is the transferTyping_done.txt

```
open sftp://<user_name>:<password>@<ip>/ -hostkey="some random letters for hotkey"

## Change the location of the files
lcd "L:\Location_of_file_uploaddone.txt"

## Go to directory
cd /Final_location_on_HPC

## Transfer of files and delete it
put -delete uploaddone.txt

exit

```
